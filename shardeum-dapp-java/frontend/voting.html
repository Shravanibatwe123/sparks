<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Voting & Polls</title>
<style>
/* Reset & Base */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: #fff;
  min-height: 100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px;
}
.container { width:100%; max-width:600px; text-align:center; }
h1 { margin-bottom:20px; font-size:2.5rem; text-shadow:2px 2px 10px rgba(0,0,0,0.3); }
.card {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  padding:20px;
  border-radius:15px;
  margin:20px 0;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
.input-field {
  width:80%;
  padding:10px 15px;
  margin:10px 0;
  border-radius:10px;
  border:none;
  outline:none;
}
.btn {
  padding:12px 25px;
  margin:10px 5px;
  border:none;
  border-radius:25px;
  cursor:pointer;
  font-size:1rem;
  transition:0.3s ease;
}
.btn-primary { background:#ff7e5f; color:#fff; }
.btn-primary:hover { background:#feb47b; transform:scale(1.05); }
#pollArea { margin-top:20px; }
.poll-card {
  background: rgba(255,255,255,0.15);
  padding:15px 20px;
  border-radius:15px;
  margin:10px 0;
  text-align:left;
  transition: transform 0.3s;
}
.poll-card:hover { transform: translateY(-5px); }
.poll-card h3 { margin-bottom:10px; }

/* Progress bar */
.option-bar {
  background: rgba(255,255,255,0.2);
  border-radius:10px;
  overflow:hidden;
  margin:5px 0;
}
.option-fill {
  background:#ff7e5f;
  height:25px;
  width:0%;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: width 0.5s ease;
  border-radius:10px;
  color:#fff;
  font-weight:bold;
}
.poll-card button {
  margin:5px 5px 0 0;
  border-radius:10px;
  padding:8px 15px;
  border:none;
  cursor:pointer;
  transition:0.2s;
}
.poll-card button:hover { opacity:0.9; }
</style>
<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
</head>
<body>
<div class="container">
  <h1>üó≥Ô∏è Voting & Polls</h1>
  <button id="connectBtn" class="btn">Connect Wallet</button>
  
  <div id="createArea" class="card">
    <h2>Create Poll</h2>
    <input id="title" placeholder="Poll Title" class="input-field">
    <input id="options" placeholder="Options (comma-separated)" class="input-field">
    <button id="createPoll" class="btn btn-primary">Create Poll</button>
  </div>
  
  <div id="pollArea" class="poll-container"></div>
</div>

<script>
const polls = {}; // Store polls and votes

document.getElementById("connectBtn").addEventListener("click", async () => {
  if (window.ethereum) {
    try {
      await ethereum.request({ method: "eth_requestAccounts" });
      alert("Wallet connected!");
    } catch (err) {
      console.log(err);
      alert("Connection failed.");
    }
  } else {
    alert("Install MetaMask!");
  }
});

document.getElementById("createPoll").addEventListener("click", () => {
  const title = document.getElementById("title").value.trim();
  const options = document.getElementById("options").value.split(",").map(opt => opt.trim()).filter(opt => opt);

  if (!title || options.length === 0) {
    alert("Please enter a title and options");
    return;
  }

  polls[title] = options.map(() => 0); // Initialize votes

  const pollArea = document.getElementById("pollArea");
  const pollCard = document.createElement("div");
  pollCard.className = "poll-card";
  pollCard.id = "poll-" + title.replace(/\s+/g, "_");

  let optionsHtml = "";
  options.forEach((opt, index) => {
    optionsHtml += `
      <div>
        <button onclick="vote('${title}', ${index})">${opt}</button>
        <div class="option-bar">
          <div class="option-fill" id="${title.replace(/\s+/g, "_")}-option-${index}">0%</div>
        </div>
      </div>`;
  });

  pollCard.innerHTML = `<h3>${title}</h3>${optionsHtml}`;
  pollArea.appendChild(pollCard);

  document.getElementById("title").value = "";
  document.getElementById("options").value = "";
});

function vote(title, optionIndex) {
  polls[title][optionIndex]++;
  updatePoll(title);
}

function updatePoll(title) {
  const votes = polls[title];
  const totalVotes = votes.reduce((a,b)=>a+b,0);
  votes.forEach((v,index)=>{
    const percent = totalVotes === 0 ? 0 : Math.round((v/totalVotes)*100);
    const fillBar = document.getElementById(`${title.replace(/\s+/g, "_")}-option-${index}`);
    fillBar.style.width = percent + "%";
    fillBar.textContent = percent + "%";
  });
}
</script>
</body>
</html>
